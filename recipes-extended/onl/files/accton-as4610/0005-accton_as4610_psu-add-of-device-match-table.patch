From 5b3121fb3b6e122f04b8411485dbc3e240342d63 Mon Sep 17 00:00:00 2001
From: Jonas Gorski <jonas.gorski@bisdn.de>
Date: Fri, 26 Aug 2022 12:10:23 +0200
Subject: [PATCH 5/8] accton_as4610_psu: add of device match table

For on-demand loading to work the kernel needs to know which compatibles
are handled by the driver, so add an appropriate table.

Upstream-Status: Unsubmitted
Signed-off-by: Jonas Gorski <jonas.gorski@bisdn.de>
---
 .../armxx/arm-accton-as4610/modules/accton_as4610_psu.c  | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/packages/platforms/accton/armxx/arm-accton-as4610/modules/accton_as4610_psu.c b/packages/platforms/accton/armxx/arm-accton-as4610/modules/accton_as4610_psu.c
index 0ad218228f7f..ec3c75a51153 100644
--- a/packages/platforms/accton/armxx/arm-accton-as4610/modules/accton_as4610_psu.c
+++ b/packages/platforms/accton/armxx/arm-accton-as4610/modules/accton_as4610_psu.c
@@ -33,6 +33,7 @@
 #include <linux/slab.h>
 #include <linux/delay.h>
 #include <linux/dmi.h>
+#include <linux/of.h>
 #include <linux/version.h>
 
 #define MAX_MODEL_NAME 11
@@ -210,10 +211,18 @@ static const struct i2c_device_id as4610_psu_id[] = {
 };
 MODULE_DEVICE_TABLE(i2c, as4610_psu_id);
 
+static const struct of_device_id as4610_psu_of_id[] = {
+	{ .compatible = "accton,as4610_psu1", .data = as4610_psu1 },
+	{ .compatible = "accton,as4610_psu2", .data = as4610_psu2 },
+	{}
+};
+MODULE_DEVICE_TABLE(of, as4610_psu_of_id);
+
 static struct i2c_driver as4610_psu_driver = {
 	.class		  = I2C_CLASS_HWMON,
 	.driver = {
 		.name	  = "as4610_psu",
+		.of_match_table = as4610_psu_of_id,
 	},
 	.probe		  = as4610_psu_probe,
 #if LINUX_VERSION_CODE >= KERNEL_VERSION(6,1,0)
-- 
2.42.0

