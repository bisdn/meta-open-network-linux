From 61b0270d056c5eba4ae9a284ad6871c42e37aa72 Mon Sep 17 00:00:00 2001
From: Jonas Gorski <jonas.gorski@bisdn.de>
Date: Tue, 22 Nov 2022 13:50:28 +0100
Subject: [PATCH 3/5] accton-as5835-54x: do not call
 hwmon_device_register_with_info() with NULL chip

hwmon_device_register_with_info() is supposed to require hwmon_chip_info
being passed, so passing NULL is not valid.

Recent kernels enforce this, but supplying valid hwmon_chip_info would
require rewriting the whole driver.

So instead revert to the old call and live with the warning.

// <smpl>
@@
expression ret;
expression E1,E2;
@@
-ret = hwmon_device_register_with_info(E1, E2, NULL, NULL, NULL);
+ret = hwmon_device_register(E1);
// </smpl>

Signed-off-by: Jonas Gorski <jonas.gorski@bisdn.de>
---
 .../as5835-54x/modules/builds/x86-64-accton-as5835-54x-fan.c   | 3 +--
 .../as5835-54x/modules/builds/x86-64-accton-as5835-54x-psu.c   | 3 +--
 2 files changed, 2 insertions(+), 4 deletions(-)

diff --git a/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-fan.c b/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-fan.c
index 892dd0e87fa7..d12cc7fabe19 100644
--- a/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-fan.c
+++ b/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-fan.c
@@ -436,8 +436,7 @@ static int as5835_54x_fan_probe(struct i2c_client *client,
         goto exit_free;
     }
 
-    data->hwmon_dev = hwmon_device_register_with_info(&client->dev, "as5835_54x_fan",
-                                                      NULL, NULL, NULL);
+    data->hwmon_dev = hwmon_device_register(&client->dev);
     if (IS_ERR(data->hwmon_dev)) {
         status = PTR_ERR(data->hwmon_dev);
         goto exit_remove;
diff --git a/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-psu.c b/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-psu.c
index 4fa736a40da4..81000e42abd0 100644
--- a/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-psu.c
+++ b/packages/platforms/accton/x86-64/as5835-54x/modules/builds/x86-64-accton-as5835-54x-psu.c
@@ -191,8 +191,7 @@ static int as5835_54x_psu_probe(struct i2c_client *client,
 		goto exit_free;
 	}
 
-    data->hwmon_dev = hwmon_device_register_with_info(&client->dev, "as5835_54x_psu",
-                                                      NULL, NULL, NULL);
+    data->hwmon_dev = hwmon_device_register(&client->dev);
 	if (IS_ERR(data->hwmon_dev)) {
 		status = PTR_ERR(data->hwmon_dev);
 		goto exit_remove;
-- 
2.38.1

