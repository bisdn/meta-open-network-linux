#@TYPE: Machine
#@NAME: accton-as4610-30

#@DESCRIPTION: Machine configuration for accton-as4610-30 systems

PREFERRED_PROVIDER_virtual/kernel ?= "linux-yocto-onl"
PREFERRED_VERSION_linux-yocto-onl ?= "6.1%"

KMACHINE:accton-as4610 = "armel-iproc"
KERNEL_FEATURES += "bsp/armel-iproc"

DEFAULTTUNE ?= "cortexa9"
require conf/machine/include/qemu.inc
require conf/machine/include/arm/armv7a/tune-cortexa9.inc
require conf/machine/include/onl.inc

MACHINE_FEATURES += "pcbios"
MACHINE_FEATURES:remove = "alsa"

KERNEL_FEATURES:remove = "features/debug/printk.scc features/kernel-sample/kernel-sample.scc"

# https://git.yoctoproject.org/poky/tree/meta/classes/kernel-fitimage.bbclass
KERNEL_CLASSES += "kernel-fitimage"

KERNEL_IMAGETYPE = "fitImage"
UBOOT_ENTRYPOINT="0x61008000"
UBOOT_RD_LOADADDRESS = "0x00000000"
UBOOT_RD_ENTRYPOINT = "0x00000000"
# AS4610 U-Boot does not support sha256
FIT_HASH_ALG = "sha1"
KERNEL_EXTRA_ARGS += "LOADADDR=${UBOOT_ENTRYPOINT}"
KERNEL_DEVICETREE = "arm-accton-as4610.dtb arm-accton-as4610-30t.dtb arm-accton-as4610-30p.dtb arm-accton-as4610-54t.dtb arm-accton-as4610-54p.dtb"
BISDN_ARCH = "u-boot-arch"

ONIE_VENDOR = "accton"
ONIE_MACHINE_TYPE = "as4610_30"

ONL_PLATFORM_SUPPORT = " \
    arm-accton_as4610_30-r0 \
    arm-accton_as4610_54-r0 \
"

MACHINE_EXTRA_RDEPENDS += " \
    accton-as4610-poe-mcu-mod \
    kernel-module-accton-as4610-cpld \
    kernel-module-accton-as4610-fan \
    kernel-module-accton-as4610-leds \
    kernel-module-accton-as4610-psu \
    kernel-module-optoe \
    kernel-module-ym2651y \
    platform-onl-init \
"

UBOOT_CONFIG = "sandbox"
UBOOT_CONFIG[sandbox] = "sandbox_defconfig"

PREFERRED_RPROVIDER_u-boot-default-env = "platform-onl-init"
